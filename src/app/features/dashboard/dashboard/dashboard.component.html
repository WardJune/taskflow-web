<app-navbar />

<div class="max-w-4xl mx-auto px-6 py-8">
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-2xl font-bold text-gray-800">My Projects</h1>
    <button
      class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 text-sm hover:cursor-pointer"
      (click)="showForm.set(!showForm())"
    >
      {{ showForm() ? 'Cancel' : '+ New Project' }}
    </button>
  </div>

  @if (errorMessage()) {
    <div class="bg-red-50 text-red-600 px-4 py-3 rounded mb-4">
      {{ errorMessage() }}
    </div>
  }

  @if (showForm()) {
    <div class="bg-white border rounded-lg p-6 mb-6 shadow-sm">
      <h2 class="font-semibold text-gray-700 mb-4">Create New Project</h2>
      <form [formGroup]="createForm" (ngSubmit)="createProject()">
        <div class="mb-3">
          <input
            formControlName="name"
            type="text"
            placeholder="Project name"
            class="w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
        </div>
        <div class="mb-4">
          <textarea
            formControlName="description"
            placeholder="Description (optional)"
            rows="2"
            class="w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
          </textarea>
        </div>
        <button
          type="submit"
          [disabled]="createForm.invalid || isCreating()"
          class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:opacity-50 text-sm"
        >
          {{ isCreating() ? 'Creating...' : 'Create Project' }}
        </button>
      </form>
    </div>
  }

  @if (isLoading()) {
    <div class="text-center py-12 text-gray-400">Loading projects...</div>
  } @else if (projects().length === 0) {
    <div class="text-center py-12 text-gray-400">
      <p class="text-lg mb-2">No projects yet</p>
      <p class="text-sm">Create your first project to get started</p>
    </div>
  } @else {
    <div class="grid gap-4">
      @for (project of projects(); track project.id) {
        <a
          [routerLink]="['/projects', project.id]"
          class="block bg-white border rounded-lg p-5 hover:shadow-md transition-shadow"
        >
          <div class="flex items-start justify-between">
            <div>
              <h3 class="font-semibold text-shadow-gray-800">
                {{ project.name }}
              </h3>
              @if (project.description) {
                <p class="text-sm text-gray-500 mt-1">{{ project.description }}</p>
              }
            </div>
            <span class="text-xs text-graytext-gray-400">
              {{ project.created_at | date: 'mediumDate' }}
            </span>
          </div>
        </a>
      }
    </div>
  }
</div>
